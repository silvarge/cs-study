# AOP(Aspect Oriented Programming)

관점 지향 프로그래밍

로깅, 트랜잭션과 같이 부가적인 기능의 모듈화를 통해 생산성을 개선하는 프로그래밍 기법

- 어떤 로직을 기준으로 핵심적인 관점, 부가적인 관점으로 나누어서 보고 그 관점을 기준으로 각각 모듈화하겠다는 것
- 횡단 관심사의 분리를 허용함으로써 모듈성을 증가시키는 것이 목적인 프로그래밍 패러다임

⇒ 결국에는 유지보수하기에 쉬운 코드를 만들기 위함

### 객체 지향 프로그래밍(OOP)와의 관계

- AOP는 OOP를 돕는 보조적인 기술
- 관심사의 분리의 문제를 해결하기 위해 만들어진 프로그래밍 패러다임
- 하나의 기능을 핵심 관심 사항과 공통 관심 사항으로 분리시키고 각각을 모듈화하는 것을 의미
    - OOP를 적용한다 하더라도, 핵심 기능에서 부가 기능을 쉽게 분리된 모듈로 작성하기 어려운 문제점을 AOP가 해결
- 핵심 기능에서 부가 기능을 분리함으로써 핵심 기능을 설계하고 구현할 때 객체 지향 적인 가치를 지킬 수 있게 도와주는 개념

## AOP는 언제 사용할까?

- 로깅 및 모니터링: 메서드 실행 시 로그를 남기거나 성능을 모니터링 하는 경우
- 보안 검사: 메서드 호출 전에 사용자 인증이나 권한 검사를 수행
- 트랜잭션 관리: 비즈니스 로직의 실행을 트랜잭션으로 관리

### 모든 메서드의 호출 시간을 측정하는 것을 생각해보자

#### AOP를 적용하기 전

- 시간을 측정하는 로직은 공통 관심 사항이다
- 시간을 측정하는 로직과 핵심 비즈니스의 로직이 섞여서 유지보수가 어렵다
- 시간을 측정하는 로직을 별도의 공통 로직으로 만들기 매우 어렵다.
- **시간을 측정하는 로직을 변경할 때 모든 로직을 찾아가면서 변경해야 한다**

#### AOP를 적용한 후

- 회원 가입, 회원 조회 등 핵심 관심사항과 시간을 측정하는 공통 관심 사항을 분리
- 시간을 측정하는 로직을 별도의 공통 로직으로 만든다
- 핵심 관심 사항을 깔끔하게 유지할 수 있다. → 서비스 메서드에 시간 계산 로직을 넣지 않아도 됨!
- 변경이 필요하다면 이 로직만 변경하면 된다
- 원하는 적용 대상을 선택할 수 있다

## AOP의 장단점

### 장점

- 관심사의 분리(모듈성 향상): 비즈니스 로직과 공통 관심사를 분리하여 코드의 가독성과 유지보수성을 높임
- 중복 코드 감소: 공통 기능을 한 곳에 모아서 관리함으로써 중복된 코드를 줄임
- 유연성 증가/상위 통제: 공통 기능을 여러 모듈에서 재사용 할 수 있어 개발 생산성이 높아짐

### 단점

- 복잡성 증가: AOP를 적용하면서 코드의 흐름이 복잡해질 수 있고, 이는 디버깅을 어렵게 함
- 성능 저하 가능성: 잘못 설계된 AOP는 성능에 악영향을 줄 수 있다
- 학습 곡선: AOP 개념을 처음 접하는 개발자에게는 이해하기 어려울 수 있다
- AOP에서 해 주는 로직을 정확히 모르면 내가 예상치 못한 방향으로 코드가 작동할 수 있다.

## 프로젝트에 AOP를 도입할 때 고려해야 할 사항

- 남용 방지: AOP의 과도한 사용은 코드의 실행 흐름을 복잡하게 만들 수 있음, 적절한 수준에서 사용
- 포인트컷 표현식의 정확성: AOP를 효과적으로 구현하기 위해서는 포인트컷 표현식을 정확하고 명확하게 작성해야 함
- 프로젝트의 복잡성과 유지보수성 고려: AOP를 도입하기 전, 프로젝트의 복잡성과 유지보수성을 고려하여 AOP의 사용이 실제로 이점을 가져다 줄지를 판단해야 함

# AOP 관련 용어

| 용어 | 설명 |
| --- | --- |
| Aspect | AOP의 기본 모듈<br>한 개 혹은 그 이상의 포인트컷과 어드바이스 조합으로 구성되며, 보통은 싱글톤 객체로 존재 |
| Advisor | 어드바이저 = 포인트컷 + 어드바이스<br>포인트컷과 어드바이스를 각각 하나씩 갖는 오브젝트 = 어드바이저, 아주 단순한 Aspect<br>일반적인 AOP에서 사용되는 용어가 아닌, 스프링 AOP에서만 사용되는 특별한 용어 |
| Target | 부가 기능을 제공할 대상<br>주로 핵심 기능을 담은 클래스가 대상이 됨.<br>간혹 다른 부가기능을 제공하는 프록시 오브젝트가 되기도 함. |
| Advice | 타깃에게 제공할 부가 기능을 담은 모듈 |
| Join Point | 어드바이스가 적용될 수 있는 위치<br>ex) 스프링의 프록시를 이용한 AOP에서 조인 포인트는 메서드 실행 단계 |
| PointCut | 어드바이스를 적용할 조인 포인트를 선별하는 기능<br>ex) 스프링 AOP의 조인 포인트는 메서드 실행이기 때문에, 스프링의 포인트 컷이라 하면 메서드를 선정하는 기능을 말함 |
| Proxy | 클라이언트와 타깃 사이에 존재하며, 부가 기능을 제공하는 객체<br>프록시는 대리자라고도 하는데, 중간에서 클라이언트의 호출을 대신 받아 타깃에 위임<br>위임 과정 중, 부가 기능을 부여하는 데, 스프링 프레임워크는 이러한 프록시 객체를 통해 AOP를 지원 |
| Weaving | 컴파일 타임, 로드 타임, 또는 런타임에 어드바이스를 애플리케이션의 지정된 조인 포인트에 삽입하는 과정<br>포인트컷에 의해 지정된 핵심 메서드가 호출될 때, 어드바이스를 적절히 삽입하는 과정 |

# AOP 적용 기술

Java에서 AOP 구현 종류는 크게 두 가지로 나뉜다

- Spring AOP: Spring에서 사용하는 AOP 기능
    - Spring IoC를 활용해 간단한 AOP 제공
    - Bean만 적용 대상이 된다
- AspectJ: PARC에서 개발한 자바 AOP 확장 기능
    - 완벽한 AOP 기능을 제공하는 근본 기술
    - 구현이 복잡

# 스프링의 AOP 동작 방식

Spring AOP를 기반으로 우선 조사해 보았다.

AOP를 이용하여, 애플리케이션의 특정 조인 포인트에 Aspect를 적용할 때, 프록시 객체를 생성하여 원본 객체를 감싸는 방식으로 Aspect의 코드를 실행하게 된다.

이 프록시 객체는 원본 객체의 호출을 가로채 Aspect에 정의된 공통 기능(Advice)를 실행한 다음, 원본 객체의 메서드를 호출

이 과정을 통해 개발자는 핵심 비즈니스 로직을 수정하지 않고도 공통 관심사를 효율적으로 관리할 수 있음

<img width="1059" height="730" alt="image" src="https://github.com/user-attachments/assets/74bd66fc-8296-4113-81a7-90f0bb126989" />

- 이 때, Spring AOP 프록시 객체에는 두 가지 메커니즘이 존재
    - JDK 동적 프록시: java.lang.reflection.Proxy를 사용하여 프록시를 생성
    - CGLIB 프록시: 바이트 코드 조작을 통한 직접 프록시 객체 생성
    
    ⇒ 결론적으로는 CGLIB 프록시 객체 생성이 더 좋다고 한다. 하지만 그만큼의 위험성도 있겠지?
    
    → 이 내용은 조금 더 살펴봐야 할 것 같다.

# 참고자료

https://github.com/cs-wiki/cs-wiki/issues/9

https://njunju77.tistory.com/117 ← 이건 좀 더 읽어보면 좋을 듯

https://curiousjinan.tistory.com/entry/spring-aop-understand

https://tech.kakaopay.com/post/overcome-spring-aop-with-kotlin/

[https://jihyunhillcs.tistory.com/34#AOP(Aspect_Oriented_Programming)란_무엇일까](https://jihyunhillcs.tistory.com/34#AOP(Aspect_Oriented_Programming)%EB%9E%80_%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C)?

https://hanjo8813.github.io/spring/6/

https://rnrwk0502.tistory.com/62#4._AspectJ_vs_Spring_AOP

[https://jihyunhillcs.tistory.com/34#AOP(Aspect_Oriented_Programming)란_무엇일까](https://jihyunhillcs.tistory.com/34#AOP(Aspect_Oriented_Programming)%EB%9E%80_%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C)?
