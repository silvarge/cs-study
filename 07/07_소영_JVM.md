## 목표

자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기

---

## JVM이란 무엇인가

-   **JVM(Java Virtual Machine):** 자바 가상 머신
-   자바를 실행하기 위한 가상 기계(컴퓨터)
-   Java가 OS에 종속받지 않고, 어느 OS 위에서든 실행되기 위해서 필요한 장치
-   즉, OS에 종속받지 않고 CPU가 Java 프로그램을 실행할 수 있게 하기 위한 가상 컴퓨터

---

## 컴파일하는 방법

일반적인 언어는 소스 코드를 CPU가 바로 이해할 수 있는 기계로 한 번에 변환합니다.

하지만 자바는 JVM이라는 중간 단계를 거치기 때문에 변환 과정이 두 단계로 나누어집니다.

-   1차 변환: 소스 코드 → 바이트코드(Bytecode)

자바 소스 코드(\`.java\`)가 자바 바이트코드( \`.class\`)로 변환됩니다.

이때 **바이트코드란 CPU가 아니라, JVM이 인식하는 언어**로 

**자바의 플랫폼 독립성을 가능하게 하는 요소**입니다.

-   2차 변환: 바이트코드 → 기계어

JVM이 바이트코드를 받아 CPU가 실행할 수 있는 기계어로 변환하는 과정으로

\`.class\` 파일을 읽어 해당 OS에 맞는 기계어 코드로 해석됩니다.

즉, OS가 자바 코드를 직접 인식하는 것이 아니라, **OS 위에서 동작하는 JVM이 바이트코드를 받아서 OS의 언어로 통역해 주는 역할을 한다**고 볼 수 있습니다.

```
public class HelloWorld {

  public static void main(String[] args) {
    System.out.println("JVM 실습");
  }

}
```

\`javac\` 명령어로 자바 소스코드를 컴파일할 수 있습니다.

\`javac HelloWorld.java\`를 입력하면 아래 사진처럼 \`.class\` 파일이 생성됩니다.

<img width="219" height="95" alt="image" src="https://github.com/user-attachments/assets/2bbae605-f9a3-42ae-96f0-319f0afdfe5c" />

---

## 실행하는 방법

\`java\` 명령어로 \`.class\` 파일을 실행할 수 있습니다.

<img width="475" height="42" alt="image" src="https://github.com/user-attachments/assets/629a1442-e6d4-4882-8523-6441c1b777e0" />

---

## JIT 컴파일러란 무엇인가?

자바 바이트코드는 CPU가 아니라 JVM이 이해할 수 있는 언어로,

JVM은 이 바이트코드를 해당 OS의 CPU가 이해할 수 있는 기계어로 변환합니다.

이때 JVM이 바이트코드를 기계어로 변환하는 가장 기본적인 방식은 **인터프리터**를 이용하는 것입니다.

-   인터프리터는 **바이트코드 명령어를 한 줄씩 읽고**, 이를 OS에 맞는 기**계어로 즉시 해석**하여 CPU에 전달하고, C**PU가 이 명령을 바로 실행**합니다.
-   코드를 미리 컴파일할 필요가 없어 프로그램 구동 속도가 빠릅니다.
-   그러나 동일한 코드가 반복적으로 실행될 때도 매번 다시 해석해야 하므로, 전체 실행 속도는 느립니다.

이처럼 느린 속도라는 인터프리터의 단점을 보완하기 위해 JIT 컴파일러를 사용합니다.

**JIT 컴파일러란?**

-   JIT(Just-In-Time) 컴파일러는 **인터프리터 방식으로 실행하다 적절한 시점에 자주 사용되는 코드 블록(메소드 단위)를 기계어 코드로 변환**합니다.
-   컴파일된 코드(기계어)는 캐시에 보관되기 때문에 한 번 컴파일된 코드는 이후 실행 시 빠르게 수행됩니다.

JIT 컴파일러가 컴파일하면 인터프리터가 바이트코드를 한 줄씩 해석하는 것보다 오래 걸리므로 한 번만 실행되는 코드라면 인터프리팅을 하는 게 낫습니다.

따라서 JVM은 내부에서 해당 메소드의 수행 빈도를 확인한 후 일정 정도를 넘을 때 JIT 컴파일러를 사용합니다.

---

## JVM 구성 요소

<img width="1228" height="974" alt="image" src="https://github.com/user-attachments/assets/79cfd089-a4a1-4858-ab6e-52dbacdfec9f" />

JVM 내부 크게 클래스 로더, 메모리 영역, 실행 엔진으로 구분됩니다.

-   **클래스 로더 시스템(Class Loader System)**
    -   자바 애플리케이션 실행에 필요한 클래스 파일을 JVM 메모리 영역으로 동적으로 로드하는 역할
    -   바이트코드(\`.class\`)들을 메모리 영역에 배치시키는 역할
    -   클래스를 메모리에 한 번에 올리지 않고, 애플리케이션에서 필요한 경우 동적으로 올립니다. 
-   **메모리(Runtime Data Area)**
    -   프로그램 실행을 위해 데이터를 저장하는 공간
    -   이 영역은 다시 스레드 공유 영역과 스레드 독립 영역으로 구분됩니다.
    -   스레드 공유 영역
        -   모든 스레드가 접근 가능한 영역으로 힙, 메소드 영역이 해당됩니다.
        -   힙(heap): 객체와 배열이 저장되는 영역
        -   메소드 영역: 클래스 구조 정보, 정적 변수, 상수 등의 메타데이터가 저장되는 영역
    -   스레드 독립 영역
        -   각 스레드가 생성될 때마다 독립적으로 할당되는 영역으로 스택, PC 레지스터, 네이티브 메소드 스택이 해당됩니다.
        -   스택(stack): 메소드 호출 시 사용되는 지역 변수, 매개 변수, 메소드 정보 등이 저장되는 영역
        -   PC 레지스터(Program Counter Register): 현재 실행 중인 JVM 명령어의 주소가 저장되는 영역
        -   네이티브 메소드 스택(Native Method Stack): 자바 외의 언어로 작성된 네이티브 코드를 호출할 때 사용하는 스택
-   **실행 엔진(Execution Engine)**
    -   클래스 로더가 메모리에 올려놓은 바이트코드(클래스 파일)를 실제로 실행하는 역할
    -   인터프리터(Interpreter): 바이트코드를 한 줄씩 읽어 즉시 기계어로 해석하여 실행하는 방식
    -   JIT 컴파일러(Just-In-Time Compiler): 자주 사용되는 코드를 기계어로 컴파일하여 캐시해두는 방식
    -   가비지 컬렉터(Garbage Collector, GC): 힙 영역에서 더 이상 참조되지 않는 객체를 찾아 자동으로 메모리에서 제거하고 자원을 회수하는 역할

---

## JDK와 JRE

**JRE란?: JVM + 핵심 라이브러리**

-   Java Runtime Environment: 자바 애플리케이션 실행을 위한 환경
-   JVM과 핵심 라이브러리로 구성되어 컴파일 된 자바 프로그램을 실행하기 위해 필요한 패키지
-   이미 만들어진 자바 프로그램(\`.jar\` 또는 \`.class\`)을 실행만 할 때 필요

**JDK란?: JRE + 개발 도구**

-   Java Development Kit: 자바 애플리케이션 개발을 위한 도구 세트
-   JRE+개발에 필요한 툴로 구성되어 있으며 개발(코드를 작성하고, 컴파일하고, 디버깅)하기 위해 필요
-   Java11부터는 JDK만 제공하며, JRE는 따로 제공되지 않습니다.

---

참고자료

-   목표와 학습 내용은 [백기선님의 스터디 프로젝트](https://github.com/whiteship/live-study/issues/1)를 참고했습니다.
-   [\[JAVA\] JVM이란? 개념 및 구조 (JDK, JRE, JIT, 가비지 콜렉터...)](https://doozi0316.tistory.com/entry/1%EC%A3%BC%EC%B0%A8-JVM%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EB%A9%B0-%EC%9E%90%EB%B0%94-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%8B%A4%ED%96%89%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80)
-   [\[1주차\] JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.](https://catsbi.oopy.io/df0df290-9188-45c1-b056-b8fe032d88ca)
