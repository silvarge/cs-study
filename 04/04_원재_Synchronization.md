# Synchroniztion

공유 데이터에 동시에 여러 스레드가 접근하면 데이터 일관성을 해칠 수 있다. 이런 상황을 **경쟁 상태**(Race condition)이라고 한다. 데이터 일관성을 유지하기 위해서는 스레드들이 순차적으로 실행될 수 있도록 하는 기법이 필요한데, 이를 **동기화**(Synchroniztion)라고 한다.

여러 스레드가 공유하는 데이터에 접근하고 갱신하는 코드 부분을 **임계 구역**(Critical Section)이라고 한다. 한 번에 하나의 스레드만이 임계 구역에 진입해 코드를 실행할 수 있다. 임계 구역 문제를 해결하는 알고리즘은 다음 3가지 조건을 만족해야 한다.

- 상호 배제(Mutual Exclusion)
  - 한 스레드가 임계 구역에 진입해있다면, 다른 스레드는 진입할 수 없음
- 진행(Progress)
  - 임계구역이 비어 있다면 어떤 스레드가 진입할 지 바로 정해저야 함
- 한정 대기(Bounded waiting)
  - 언젠가는 스레드가 임계 구역에 진입할 수 있어야 함

## Mutex

뮤텍스는 락을 사용하는 방식이다. 임계 구역에 접근할 때 락을 획득한 스레드만 접근할 수 있고, 나올 때 락을 반환해야 한다. 락을 획득하지 못한 스레드는 임계 구역에 접근할 수 없다.

## Semaphores

세마포어는 하나의 정수 변수다. 이 정수에는 wait(P), signal(V) 연산이 존재하며 각각 정수의 값을 감소, 증가시키는 연산이다. 이 연산은 원자적이기 때문에 중간에 중단될 수 없다. 또한 연산이 진행되는 동안 다른 스레드에서 값을 수정할 수 없다.

임계 구역에 접근하기 전에 wait 연산을 실행해서 값을 감소시키고, 나올 때 signal 연산을 실행해서 값을 증가시킨다. 세마포어의 종류에는 2가지가 있다.

- 바이너리 세마포어
  - 가질 수 있는 값이 0과 1뿐인 세마포어
  - 뮤텍스와 유사하게 작동함
- 카운팅 세마포어
  - 가질 수 있는 값의 범위가 정해지지 않은 세마포어
  - 초기값은 가용한 자원의 개수로 정해짐

## Monitor

모니터는 하이 레벨 언어에서 제공하는 동기화 방법이다. 한 순간에 하나의 스레드만 모니터에서 활동할 수 있도록 보장한다. 공유 자원을 숨기고 접근할 수 있는 인터페이스만 제공한다.

## Deadlock

**교착 상태**(Deadlock)은 두 개 이상의 스레드들이 서로가 가진 자원을 기다리며 계속 기다리는 상태를 의미한다.

다음 4가지 원인이 동시에 성립될 때 발생할 수 있다.

- 상호 배제
  - 자원을 한 스레드가 독점하고 있으며, 다른 스레드는 접근할 수 없다.
- 점유 대기
  - 하나의 자원을 점유한 채 다른 자원을 얻기 위해서 대기한다.
- 비선점
  - 점유하고 있는 자원을 강제로 가져올 수 없고 해제될 때까지 기다려야 한다.
- 환형 대기
  - 서로가 점유하고 있는 자원을 요구하며 대기한다.

