# Spring MVC μ”μ²­ μƒλ…μ£ΌκΈ°

<img width="784" height="693" alt="image" src="https://github.com/user-attachments/assets/11622447-ba0f-4e46-9807-f33eae3deaa1" />

# ν•„ν„°

> **J2EE ν‘μ¤€ μ¤ν™ κΈ°λ¥**
> 
> 
> λ””μ¤ν¨μ² μ„λΈ”λ¦Ώ(Dispatcher Servlet)μ— μ”μ²­μ΄ μ „λ‹¬λκΈ° μ „/ν›„μ— μν–‰λ¨.
> 
> URL ν¨ν„΄μ— λ§λ” λ¨λ“  μ”μ²­μ— λ€ν•΄ λ¶€κ°€ μ‘μ—…μ„ μ²λ¦¬ν•  μ μλ” κΈ°λ¥μ„ μ κ³µ
> 
> μ›Ή μ»¨ν…μ΄λ„μ—μ„ λ™μ‘ (WAS, λ λ²¨μ—μ„ λ™μ‘)
> 
- μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅μ€ λμ§€λ§, μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ μ•„λ‹ μ›Ή μ»¨ν…μ΄λ„(ex. ν†°μΊ£)μ— μν•΄ κ΄€λ¦¬
- λ””μ¤ν¨μ² μ„λΈ”λ¦Ώ μ „/ν›„μ— μ²λ¦¬ν•λ” κ²ƒ

<img width="1158" height="564" alt="image" src="https://github.com/user-attachments/assets/79edce1b-c73e-4e61-86c5-1cec612231d1" />

## ν•„ν„°μ νλ¦„

- μ¬λ°”λ¥Έ μ „μ†΅ μ‹: HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ Dispatcher Servlet β†’ Controller
- μ „μ†΅ μ ν• μ‹: HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ μ ν¨ν•μ§€ λ»ν• μ”μ²­μ— λ€ν• μ‘λ‹µ λ°ν™
    - μ΄ λ•, Dispatcher Servletμ„ κ±°μΉμ§€ μ•κ³  ν•„ν„° λ‚΄μ—μ„ λ°”λ΅ λ°ν™μ„ μ§„ν–‰ν•λ‹¤.
- λ‹¤μ¤‘ ν•„ν„° μ μ© μ‹: HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„°1 β†’ ν•„ν„°2 β†’ ν•„ν„°3 β†’ β€¦ β†’ Dispatcher Servlet β†’ Controller
    - `chain.doFilter(request, response);` β†’ ν•„ν„° μ²΄μΈμ„ ν†µν•΄ λ‹¤μ ν•„ν„° νΉμ€ μ„λΈ”λ¦ΏμΌλ΅ μ μ–΄ μ „λ‹¬

## ν•„ν„°μ λ©”μ„λ“

> ν•„ν„°λ¥Ό μ¶”κ°€ν•κΈ° μ„ν•΄μ„λ”, `jakarta.servlet(javax.servlet)`μ Filter μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ•Ό ν•λ‹¤.
> 

```java
public interface Filter {

    default void init(FilterConfig filterConfig) throws ServletException {
    }

    void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException;

    default void destroy() {
    }
}
```

- init
    - ν•„ν„° κ°μ²΄ μ΄κΈ°ν™” λ° μ„λΉ„μ¤μ— μ¶”κ°€
    - μ›Ή μ»¨ν…μ΄λ„κ°€ init λ©”μ„λ“λ¥Ό νΈμ¶ν•μ—¬ ν•„ν„° κ°μ²΄λ¥Ό μ΄κΈ°ν™” ν• ν›„ μ΄ν›„ μ”μ²­λ“¤μ€ doFilterλ¥Ό ν†µν•΄ μ²λ¦¬λλ‹¤.
- doFilter
    - url-patternμ— λ§λ” λ¨λ“  HTTP μ”μ²­μ΄ λ””μ¤ν¨μ² μ„λΈ”λ¦ΏμΌλ΅ μ „λ‹¬λκΈ° μ „, μ›Ή μ»¨ν…μ΄λ„μ— μν•΄ μ‹¤ν–‰λλ” λ©”μ„λ“
    - μ‹¤μ λ΅ ν•„ν„°κ°€ μν–‰ν•΄μ•Ό ν•λ” λ΅μ§μ„ μ‘μ„±ν•λ” λ©”μ„λ“
    - doFilterμ νλΌλ―Έν„°λ΅λ” FilterChainμ΄ μλ”λ°, FilterChainμ doFilterλ¥Ό ν†µν•΄ λ‹¤μ λ€μƒμΌλ΅ μ”μ²­μ„ μ „λ‹¬ν•κ² λλ‹¤.
        - `chain.doFilter()` μ „/ν›„μ— μ°λ¦¬κ°€ ν•„μ”ν• μ²λ¦¬ κ³Όμ •μ„ λ„£μ–΄μ¤μΌλ΅μ¨ μ›ν•λ” μ²λ¦¬λ¥Ό μ§„ν–‰ν•  μ μλ‹¤.
- destroy
    - ν•„ν„° κ°μ²΄λ¥Ό μ„λΉ„μ¤μ—μ„ μ κ±°ν•κ³  μ‚¬μ©ν•λ” μμ›μ„ λ°ν™ν•κΈ° μ„ν• λ©”μ„λ“.
    - ν•΄λ‹Ή λ©”μ„λ“κ°€ νΈμ¶λλ©΄, μ΄ν›„μ—λ” doFilterμ— μν•΄ μ²λ¦¬λμ§€ μ•λ”λ‹¤.

### π¤” κ·Έλ ‡λ‹¤λ©΄ μ¤ν”„λ§ μ‹νλ¦¬ν‹°μ—μ„λ” μ™ SecurityConfig ν΄λμ¤μ— filterChainλ§ λ“±λ΅ν•΄λ„ μ μ‘λ™μ΄ λλ”κ±ΈκΉ? doFilter μ΄λ°κ² μ—†λ”λ°!

Spring Securityκ°€ DelegatingFilterProxyμ™€ FilterChainProxyλ¥Ό ν†µν•΄ ν•„ν„°μ μƒμ„±, μ΄κΈ°ν™”, μ‹¤ν–‰, μ†λ©Έ λ“± λ¨λ“  κ³Όμ •μ„ μλ™μΌλ΅ κ΄€λ¦¬ν•κΈ° λ•λ¬Έμ— filterChainλ§ λ“±λ΅ν•΄λ„ λ³„λ„μ λ©”μ„λ“ κµ¬ν„ μ—†μ΄ λ¨λ“  ν•„ν„°κ°€ μ •μƒμ μΌλ΅ λ™μ‘ν•λ‹¤.

μμ„Έν• κ²ƒμ€ Spring Security νλ¦„ μ •λ¦¬ν•  λ•!

# μΈν„°μ…‰ν„°

> **Springμ΄ μ κ³µν•λ” κΈ°μ  (J2EE ν‘μ¤€ μ¤ν™μ΄ μ•„λ‹)**
> 
> 
> λ””μ¤ν¨μ² μ„λΈ”λ¦Ώμ΄ μ»¨νΈλ΅¤λ¬λ¥Ό νΈμ¶ν•κΈ° μ „κ³Ό ν›„μ— μ”μ²­κ³Ό μ‘λ‹µμ„ μ°Έμ΅°ν•κ±°λ‚ κ°€κ³µν•  μ μλ” κΈ°λ¥ μ κ³µ
> 
> **μ¤ν”„λ§ μ»¨ν…μ¤νΈμ—μ„ λ™μ‘**
> 

<img width="2000" height="1500" alt="image" src="https://github.com/user-attachments/assets/7fc91daa-e8e1-40c3-b01a-bb1d3064c004" />

- μ›Ή μ»¨ν…μ΄λ„κ°€ μ•„λ‹ Spring λ‚΄λ¶€ μ»¨ν…μ¤νΈμ—μ„ μ²λ¦¬, Spring MVCμ—μ„ μ κ³µλλ” κΈ°λ¥
- λ””μ¤ν¨μ² μ„λΈ”λ¦Ώμ€ ν•Έλ“¤λ¬ λ§¤ν•‘μ„ ν†µν•΄ μ μ ν• μ»¨νΈλ΅¤λ¬λ¥Ό μ°Ύλ„λ΅ μ”μ²­ν•λ”λ°,
κ·Έ κ²°κ³Όλ΅ μ‹¤ν–‰ μ²΄μΈ(`HandlerExecutionChain`)μ„ λλ ¤μ¤€λ‹¤.
    - μ΄ μ‹¤ν–‰ μ²΄μΈμ€ 1κ° μ΄μƒμ μΈν„°μ…‰ν„°κ°€ λ“±λ΅λμ–΄ μλ‹¤λ©΄ μμ°¨μ μΌλ΅ μΈν„°μ…‰ν„°λ“¤μ„ κ±°μ³ μ¤ν”„λ§ μ»¨ν…μ΄λ„λ“¤μ„ κ±°μ³ μ»¨νΈλ΅¤λ¬κ°€ μ‹¤ν–‰λλ„λ΅ ν•κ³ , μΈν„°μ…‰ν„°κ°€ μ—†λ‹¤λ©΄ λ°”λ΅ μ»¨νΈλ΅¤λ¬λ¥Ό μ‹¤ν–‰
- μ»¨νΈλ΅¤λ¬ νΈμ¶μ μ£Όμ²΄λ” Dispatcher Servlet, μΈν„°μ…‰ν„°κ°€ μ΅΄μ¬ν•λ” κ²½μ°, μ”μ²­ κ³Όμ •μ— μ μ‹ κ°μ…ν•μ—¬ ν•„μ”ν• μ‘μ—…μ„ μν–‰ν•κ³  Dispatcher Servletμ΄ μ»¨νΈλ΅¤λ¬λ¥Ό νΈμ¶ν•λ„λ΅κ³  ν•λ‹¤.

## μΈν„°μ…‰ν„°μ λ©”μ„λ“

> μΈν„°μ…‰ν„°λ¥Ό μ¶”κ°€ν•κΈ° μ„ν•΄μ„λ” `org.springframework.web.servlet`μ `HandlerInterceptor`μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ•Ό ν•¨
> 
- ν•„ν„°μ™€ λΉ„μ·ν•μ§€λ§ μΈν„°μ…‰ν„°λ” ν•„ν„°λ³΄λ‹¤ λ” μ •κµν•κ³  λ‹¤μ–‘ν• κΈ°λ¥μ„ μ κ³µ
- Spring MVCμ— νΉν™”λ κΈ°λ¥μ„ μ κ³µν•κΈ° λ•λ¬Έμ—, νΉλ³„ν ν•„ν„°λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ” μƒν™©μ΄ μ•„λ‹λΌλ©΄ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ λ” νΈλ¦¬ν•λ‹¤.

```java
public interface HandlerInterceptor {

	default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {

		return true;
	}

	default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable ModelAndView modelAndView) throws Exception {
	}

	default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,
			@Nullable Exception ex) throws Exception {
	}

}
```

- preHandle
    - μ»¨νΈλ΅¤λ¬κ°€ νΈμ¶λκΈ° μ „ μ‹¤ν–‰
        - μ»¨νΈλ΅¤λ¬ μ΄μ „μ— μ²λ¦¬ν•΄μ•Ό ν•λ” μ „μ²λ¦¬ μ‘μ—…/μ”μ²­ μ •λ³΄λ¥Ό κ°€κ³µν•κ±°λ‚ μ¶”κ°€ν•λ” κ²½μ° μ‚¬μ© κ°€λ¥
    - 3λ²μ§Έ νλΌλ―Έν„°μΈ hander νλΌλ―Έν„°λ” ν•Έλ“¤λ¬ λ§¤ν•‘μ΄ μ°Ύμ•„μ¤€ μ»¨νΈλ΅¤λ¬ λΉμ— λ§¤ν•‘λλ” HandlerMethodλΌλ” μƒλ΅μ΄ νƒ€μ…μ κ°μ²΄, `@RequestMapping`μ΄ λ¶™μ€ λ©”μ„λ“μ μ •λ³΄λ¥Ό μ¶”μƒν™” ν• κ°μ²΄
    - λ°ν™κ°’μ΄ trueλΌλ©΄ λ‹¤μ λ‹¨κ³„λ΅ μ§„ν–‰λμ§€λ§, falseλΌλ©΄ μ‘μ—…μ„ μ¤‘λ‹¨ν•μ—¬ μ΄ν›„μ μ‘μ—…μ€ μ§„ν–‰λμ§€ μ•λ”λ‹¤.
        - μ‘μ—…μ΄ μ¤‘λ‹¨λλ” κ²½μ°, κΈ°λ³Έμ μΌλ΅ bodyκ°€ μ—†λ” 200 OKλ¥Ό λ°ν™ν•λ‹¤.
        λ¬Όλ΅ , responseλ¥Ό ν†µν•΄ κ°λ°μκ°€ μ§μ ‘ μ„¤μ •ν•  μ μλ‹¤.
- postHandle
    - μ»¨νΈλ΅¤λ¬κ°€ νΈμ¶λ ν›„μ— μ‹¤ν–‰
        - μ»¨νΈλ΅¤λ¬ μ΄ν›„μ— μ²λ¦¬ν•΄μ•Ό ν•λ” ν›„μ²λ¦¬ μ‘μ—…μ΄ μμ„ λ• μ‚¬μ©
    - μ»¨νΈλ΅¤λ¬κ°€ λ°ν™ν•λ” ModelAndView νƒ€μ…μ μ •λ³΄κ°€ μ κ³µλλ”λ°, μµκ·Όμ—λ” `@RestController`λ¥Ό λ§λ“¤λ©΄μ„ μμ£Ό μ‚¬μ©λμ§€ μ•λ”λ‹¤.
    - μ»¨νΈλ΅¤λ¬ ν•μ„ κ³„μΈµμ—μ„ μ‘μ—…μ„ μ§„ν–‰ν•λ‹¤ μ¤‘κ°„μ— μμ™Έκ°€ λ°μƒν•λ©΄ postHandleμ€ νΈμ¶λμ§€ μ•λ”λ‹¤.
    - μ‘λ‹µ κ°μ²΄ μ΅°μ‘ν•κΈ°
        - `@RestController`λ¥Ό μ‚¬μ©ν•κ±°λ‚ `Controller + ResponseBody` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•  λ•, λ…ν™•ν•κ² μ‘λ‹µμ„ λ°ν™ν•λ” κ²½μ° (dto/String, Entity λ“±),
        μΈν„°μ…‰ν„°μ—μ„ κ°μ²΄μ— λ€ν• μμ •μ΄ λ¶κ°€λ¥ν•λ‹¤.
            
            β‡’ Controllerκ°€ λ΅μ§μ„ ν†µν•΄ λ°ν™ν• μ‘λ‹µμ„ μμ •ν•λ” κ²ƒ μμ²΄κ°€ μΆ‹μ€ μ ‘κ·Όμ΄ μ•„λ‹λΌκ³  νλ‹¨ν•λ” λ“―. (filter μ—­μ‹ λ™μΌν•κ² μ μ©)
            
        - `HttpServletResponse`λ” `isCommitted` λ©”μ„λ“λ¥Ό ν†µν•΄ μμ •μ΄ κ°€λ¥ν•μ§€ μ—¬λ¶€ νλ‹¨ κ°€λ¥.
        (nullμ΄λ‚ voidμ™€ κ°™μ΄ μ‘λ‹µ κ²°κ³Όκ°€ μ—†κ±°λ‚ μ΄μ™€ μ μ‚¬ν• ν•νƒμ κ²½μ° μμ •μ΄ κ°€λ¥)
- afterCompletion
    - λ¨λ“  λ·°μ—μ„ μµμΆ… κ²°κ³Όλ¥Ό μƒμ„±ν•λ” μΌμ„ ν¬ν•¨ν•, λ¨λ“  μ‘μ—…μ΄ μ™„λ£λ ν›„μ— μ‹¤ν–‰
        - μ”μ²­ μ²λ¦¬ μ¤‘μ— μ‚¬μ©ν• λ¦¬μ†μ¤λ¥Ό λ°ν™ν•  λ• μ‚¬μ©ν•κΈ°μ— μ ν•©
    - μ»¨νΈλ΅¤λ¬ ν•μ„ κ³„μΈµμ—μ„ μ‘μ—…μ„ μ§„ν–‰ν•λ‹¤κ°€ μ¤‘κ°„μ— μμ™Έκ°€ λ°μƒν•λ”λΌλ„ `afterCompletion`μ€ λ°λ“μ‹ νΈμ¶λλ‹¤.

## μΈν„°μ…‰ν„°μ™€ AOP λΉ„κµ

μΈν„°μ…‰ν„° λ€μ‹ , μ»¨νΈλ΅¤λ¬μ— μ μ©ν•  λ¶€κ°€ κΈ°λ¥μ„ μ–΄λ“λ°”μ΄μ¤λ΅ λ§λ“¤μ–΄ AOPλ¥Ό μ μ©ν•  μλ„ μλ‹¤.

ν•μ§€λ§ μ•„λμ™€ κ°™μ€ μ΄μ λ΅ μ»¨νΈλ΅¤λ¬μ νΈμ¶ κ³Όμ •μ— μ μ©λλ” λ¶€κ°€ κΈ°λ¥λ“¤μ€ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ” νΈμ΄ λ‚«λ‹¤.

- μ»¨νΈλ΅¤λ¬λ” νƒ€μ…κ³Ό μ‹¤ν–‰ λ©”μ„λ“κ°€ λ¨λ‘ μ κ°κ°μ΄λΌ ν¬μΈνΈμ»·(μ μ©ν•  λ©”μ„λ“μ μ„ λ³„)μ μ‘μ„±μ΄ μ–΄λ µλ‹¤
- μ»¨νΈλ΅¤λ¬λ” νλΌλ―Έν„°λ‚ λ¦¬ν„΄ κ°’μ΄ μΌμ •ν•μ§€ μ•λ‹¤.
- AOPμ—μ„λ” HttpSevletRequest/Response κ°μ²΄λ¥Ό μ–»κΈ° μ–΄λ µμ§€λ§, μΈν„°μ…‰ν„°μ—μ„λ” νλΌλ―Έν„°λ΅ λ„μ–΄μ¨λ‹¤.

# ν•„ν„° VS μΈν„°μ…‰ν„°

> ν•„ν„°μ™€ μΈν„°μ…‰ν„° λ¨λ‘ λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό λ¶„λ¦¬λμ–΄ νΉμ • μ”κµ¬μ‚¬ν•­(λ³΄μ•/μΈμ¦/μΈμ½”λ”© λ“±)μ„ λ§μ΅±μ‹μΌμ•Ό ν•  λ• μ‚¬μ©
> 
- `ν•„ν„°`λ”, νΉμ • μ”μ²­κ³Ό μ»¨νΈλ΅¤λ¬μ— κ΄€κ³„μ—†μ΄ μ „μ—­μ μΌλ΅ μ²λ¦¬ν•΄μ•Ό ν•λ” μ‘μ—…μ΄λ‚ μ›Ή μ–΄ν”λ¦¬μΌ€μ΄μ… μ „λ°μ μΌλ΅ μ‚¬μ©λλ” κΈ°λ¥μ„ κµ¬ν„ν•  λ• μ μ©
- `μΈν„°μ…‰ν„°`λ”, ν΄λΌμ΄μ–ΈνΈμ μ”μ²­κ³Ό κ΄€λ ¨λ μ‘μ—…μ— λ€ν•΄ μ¶”κ°€μ μΈ μ”κµ¬μ‚¬ν•­μ„ λ§μ΅±ν•΄μ•Ό ν•  λ• μ μ©

| λ€μƒ | ν•„ν„° (Filter) | μΈν„°μ…‰ν„° (Interceptor) |
| --- | --- | --- |
| μƒνƒκ³„ | JAVA μ§„μ / μ„λΈ”λ¦Ώ | Spring MVC |
| κ΄€λ¦¬λλ” μ»¨ν…μ΄λ„ | μ„λΈ”λ¦Ώ μ»¨ν…μ΄λ„ | μ¤ν”„λ§ μ»¨ν…μ΄λ„ |
| URL ν¨ν„΄ | μ„λΈ”λ¦Ώ URL | μ¤ν”„λ§ URL, μΆ€ λ” μ„Έλ°€ν•¨ |
| μ¤ν”„λ§μ μμ™Έ μ²λ¦¬ μ—¬λ¶€ | X | O |
| Request/Response<br>κ°μ²΄ μ΅°μ‘ κ°€λ¥ μ—¬λ¶€ | O<br>(κ°μ²΄ μμ²΄λ¥Ό λ°”κΎΈκ±°λ‚/λ©ν•‘μ΄ κ°€λ¥<br>= μƒλ΅μ΄ Req/Res κ°μ²΄λ¥Ό λ§λ“¤μ–΄ λ„κΈΈ μ μλ‹¤λ” μ†λ¦¬) | X<br>(λ‚΄λ¶€ κ°’μ„ μμ •ν•  μλ” μμ§€λ§, μƒλ΅μ΄ κ²ƒμ„ λ§λ“¤κ±°λ‚ ν•λ” κ²ƒμ€ μ• λ¨/κ°μ²΄λ¥Ό λ„κΈΈ μ μ—†λ‹¤λ” μ†λ¦¬) |
| μ©λ„ | - **κ³µν†µλ** λ³΄μ• λ° μΈμ¦/μΈκ°€ κ΄€λ ¨ μ‘μ—…<br>- λ¨λ“  μ”μ²­μ— λ€ν• λ΅κΉ… λλ” κ°μ‚¬<br>- μ΄λ―Έμ§€/λ°μ΄ν„° μ••μ¶• λ° λ¬Έμμ—΄ μΈμ½”λ”©<br>- Springκ³Ό λ¶„λ¦¬λμ–΄μ•Ό ν•λ” κΈ°λ¥ | - **μ„Έλ¶€μ μΈ** λ³΄μ• λ° μΈμ¦/μΈκ°€ κ³µν†µ μ‘μ—…<br>- API νΈμ¶μ— λ€ν• λ΅κΉ… λλ” κ°μ‚¬<br>- Controllerλ΅ λ„κ²¨μ£Όλ” μ •λ³΄(λ°μ΄ν„°)μ κ°€κ³µ |

# μ°Έκ³ μλ£


https://dev-coco.tistory.com/173

https://mangkyu.tistory.com/173

https://velog.io/@uiurihappy/%EB%94%94%EC%8A%A4%ED%8C%A8%EC%B2%98-%EC%84%9C%EB%B8%94%EB%A6%BFDispatcher-Servlet

https://velog.io/@uiurihappy/Spring-%EC%9D%B8%ED%84%B0%EC%85%89%ED%84%B0Interceptor%EC%99%80-%ED%95%84%ED%84%B0Filter-%EC%B0%A8%EC%9D%B4

https://lealea.tistory.com/141
